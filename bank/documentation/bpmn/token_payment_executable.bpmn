<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_18tpbwf" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.38.1" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.4.0">
  <bpmn:collaboration id="Collaboration_0vou3qa">
    <bpmn:participant id="Participant_1f1s4uf" name="Bank" processRef="Process_1c1d0wd" />
    <bpmn:participant id="Participant_12u6dfc" name="Client" />
    <bpmn:messageFlow id="Flow_192amip" sourceRef="Participant_12u6dfc" targetRef="Event_0vtlerm" />
    <bpmn:messageFlow id="Flow_1np0x6p" sourceRef="Participant_12u6dfc" targetRef="activity_jolie_insert_payment_data" />
    <bpmn:messageFlow id="Flow_0ps6ctb" sourceRef="Event_05ntyaf" targetRef="Participant_12u6dfc" />
    <bpmn:messageFlow id="Flow_03wruq5" sourceRef="Event_1ykf3n1" targetRef="Participant_12u6dfc" />
    <bpmn:messageFlow id="Flow_0utfkay" sourceRef="Event_1mq8lgv" targetRef="Participant_12u6dfc" />
    <bpmn:messageFlow id="Flow_1eujsug" sourceRef="Event_0s9edl0" targetRef="Participant_12u6dfc" />
  </bpmn:collaboration>
  <bpmn:process id="Process_1c1d0wd" isExecutable="true">
    <bpmn:serviceTask id="Activity_0m4p540" name="Check payment data">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-check-pay-data" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1jzutgx</bpmn:incoming>
      <bpmn:outgoing>Flow_19fdb5h</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_0r8q1wv" name="Check the token">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-check-token" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1k6a148</bpmn:incoming>
      <bpmn:outgoing>Flow_0yffczr</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:startEvent id="Event_0vtlerm">
      <bpmn:outgoing>Flow_1k6a148</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0bj9l4x" messageRef="Message_01uf859" />
    </bpmn:startEvent>
    <bpmn:boundaryEvent id="Event_1fssi89" attachedToRef="Activity_13pncr1">
      <bpmn:outgoing>Flow_0jf5yrp</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_1fwe8m6" errorRef="Error_08brody" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_0s710ml" sourceRef="Gateway_0aypmq3" targetRef="Event_05ntyaf">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=statusCheckToken != "Not paid"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0vpn6ul" sourceRef="Activity_13pncr1" targetRef="Event_1mq8lgv" />
    <bpmn:sequenceFlow id="Flow_0yffczr" sourceRef="Activity_0r8q1wv" targetRef="Gateway_0aypmq3" />
    <bpmn:sequenceFlow id="Flow_199dhq7" sourceRef="Gateway_07ev7bp" targetRef="Activity_13pncr1">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=verifyPaymentDataHttpStatusCode = 200</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_19fdb5h" sourceRef="Activity_0m4p540" targetRef="Gateway_07ev7bp" />
    <bpmn:sequenceFlow id="Flow_1ck45z7" sourceRef="Gateway_0aypmq3" targetRef="activity_jolie_insert_payment_data">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=statusCheckToken = "Not paid"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1jzutgx" sourceRef="activity_jolie_insert_payment_data" targetRef="Activity_0m4p540" />
    <bpmn:sequenceFlow id="Flow_1k6a148" sourceRef="Event_0vtlerm" targetRef="Activity_0r8q1wv" />
    <bpmn:sequenceFlow id="Flow_1suz0yz" sourceRef="Gateway_07ev7bp" targetRef="Event_1ykf3n1">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=verifyPaymentDataHttpStatusCode != 200</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="Gateway_07ev7bp">
      <bpmn:incoming>Flow_19fdb5h</bpmn:incoming>
      <bpmn:outgoing>Flow_199dhq7</bpmn:outgoing>
      <bpmn:outgoing>Flow_1suz0yz</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_0aypmq3">
      <bpmn:incoming>Flow_0yffczr</bpmn:incoming>
      <bpmn:outgoing>Flow_0s710ml</bpmn:outgoing>
      <bpmn:outgoing>Flow_1ck45z7</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_13pncr1" name="Process payment">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-pay-token" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_199dhq7</bpmn:incoming>
      <bpmn:outgoing>Flow_0vpn6ul</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:receiveTask id="activity_jolie_insert_payment_data" name="Insert payment data" messageRef="Message_1f99376">
      <bpmn:incoming>Flow_1ck45z7</bpmn:incoming>
      <bpmn:outgoing>Flow_1jzutgx</bpmn:outgoing>
    </bpmn:receiveTask>
    <bpmn:endEvent id="Event_05ntyaf" name="PaymentInvalidToken">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-pay-invalid-token" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0s710ml</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0a9j2xw" />
    </bpmn:endEvent>
    <bpmn:endEvent id="Event_1mq8lgv" name="CreateTokenEndEvent">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-pay-success" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0vpn6ul</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0byu8ow" />
    </bpmn:endEvent>
    <bpmn:endEvent id="Event_1ykf3n1" name="CannotProcessPayment">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-pay-invalid-payment-data" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1suz0yz</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_01wmos0" />
    </bpmn:endEvent>
    <bpmn:endEvent id="Event_0s9edl0" name="PaymentError">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="jolie-pay-exception" retries="3" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0jf5yrp</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0pmkrsq" />
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0jf5yrp" sourceRef="Event_1fssi89" targetRef="Event_0s9edl0" />
  </bpmn:process>
  <bpmn:message id="Message_176g09v" name="CreateTokenRequest" />
  <bpmn:message id="Message_01uf859" name="PayTokenRequest" />
  <bpmn:error id="Error_08brody" name="Error_3tsgloq" errorCode="PostCheckPaymentError" />
  <bpmn:message id="Message_3qpeqjc" name="=jolieInsertPaymentData">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=token" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_1f99376" name="JolieInsertPaymentData">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=token" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0vou3qa">
      <bpmndi:BPMNShape id="Participant_1f1s4uf_di" bpmnElement="Participant_1f1s4uf" isHorizontal="true">
        <dc:Bounds x="131" y="400" width="1109" height="380" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_11i2fb6_di" bpmnElement="Activity_0m4p540">
        <dc:Bounds x="610" y="430" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1e39fsk_di" bpmnElement="Activity_0r8q1wv">
        <dc:Bounds x="230" y="530" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ilcci8_di" bpmnElement="Event_0vtlerm">
        <dc:Bounds x="171" y="552" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_07ev7bp_di" bpmnElement="Gateway_07ev7bp" isMarkerVisible="true">
        <dc:Bounds x="775" y="545" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0aypmq3_di" bpmnElement="Gateway_0aypmq3" isMarkerVisible="true">
        <dc:Bounds x="415" y="545" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0wt0zp6_di" bpmnElement="Activity_13pncr1">
        <dc:Bounds x="870" y="460" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1vq491n_di" bpmnElement="activity_jolie_insert_payment_data">
        <dc:Bounds x="470" y="430" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_12w2qih_di" bpmnElement="Event_05ntyaf">
        <dc:Bounds x="582" y="662" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="562" y="705" width="83" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_19v0lrl_di" bpmnElement="Event_1mq8lgv">
        <dc:Bounds x="1022" y="482" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="999" y="525" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0dqab4i_di" bpmnElement="Event_1ykf3n1">
        <dc:Bounds x="1062" y="612" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1040" y="655" width="83" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0xbzbhf_di" bpmnElement="Event_0s9edl0">
        <dc:Bounds x="1162" y="522" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1146" y="565" width="69" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1f1d4m6_di" bpmnElement="Event_1fssi89">
        <dc:Bounds x="952" y="522" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0s710ml_di" bpmnElement="Flow_0s710ml">
        <di:waypoint x="440" y="595" />
        <di:waypoint x="440" y="680" />
        <di:waypoint x="582" y="680" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0vpn6ul_di" bpmnElement="Flow_0vpn6ul">
        <di:waypoint x="970" y="500" />
        <di:waypoint x="1022" y="500" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0yffczr_di" bpmnElement="Flow_0yffczr">
        <di:waypoint x="330" y="570" />
        <di:waypoint x="415" y="570" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_199dhq7_di" bpmnElement="Flow_199dhq7">
        <di:waypoint x="800" y="545" />
        <di:waypoint x="800" y="500" />
        <di:waypoint x="870" y="500" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_19fdb5h_di" bpmnElement="Flow_19fdb5h">
        <di:waypoint x="660" y="510" />
        <di:waypoint x="660" y="570" />
        <di:waypoint x="775" y="570" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ck45z7_di" bpmnElement="Flow_1ck45z7">
        <di:waypoint x="440" y="545" />
        <di:waypoint x="440" y="470" />
        <di:waypoint x="470" y="470" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jzutgx_di" bpmnElement="Flow_1jzutgx">
        <di:waypoint x="570" y="470" />
        <di:waypoint x="610" y="470" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1k6a148_di" bpmnElement="Flow_1k6a148">
        <di:waypoint x="207" y="570" />
        <di:waypoint x="230" y="570" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1suz0yz_di" bpmnElement="Flow_1suz0yz">
        <di:waypoint x="800" y="595" />
        <di:waypoint x="800" y="630" />
        <di:waypoint x="1062" y="630" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0jf5yrp_di" bpmnElement="Flow_0jf5yrp">
        <di:waypoint x="988" y="540" />
        <di:waypoint x="1180" y="540" />
        <di:waypoint x="1162" y="540" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Participant_12u6dfc_di" bpmnElement="Participant_12u6dfc" isHorizontal="true">
        <dc:Bounds x="131" y="80" width="1109" height="60" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_192amip_di" bpmnElement="Flow_192amip">
        <di:waypoint x="189" y="140" />
        <di:waypoint x="189" y="552" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1np0x6p_di" bpmnElement="Flow_1np0x6p">
        <di:waypoint x="520" y="140" />
        <di:waypoint x="520" y="430" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ps6ctb_di" bpmnElement="Flow_0ps6ctb">
        <di:waypoint x="600" y="662" />
        <di:waypoint x="600" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_03wruq5_di" bpmnElement="Flow_03wruq5">
        <di:waypoint x="1080" y="612" />
        <di:waypoint x="1080" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0utfkay_di" bpmnElement="Flow_0utfkay">
        <di:waypoint x="1040" y="482" />
        <di:waypoint x="1040" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1eujsug_di" bpmnElement="Flow_1eujsug">
        <di:waypoint x="1180" y="522" />
        <di:waypoint x="1180" y="140" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>