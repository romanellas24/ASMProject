ACTORS:
user: human partecipant
local: local

acmeat-portal: front end

apidel : api microservice
apiorder: api microservice
apilocal: api microservice
apidish: api microservice
apiuser: api microservice
apimenu: api microservice


localClient: client(local)
delClient: client(deliverycompany)
userClient: client(user)
menuClient: client(menu)
dishClient: client(dish)
orderClient: client(order)
userClient: client(user)

delmanager : server microservice
ordermanager: server microservice
localmanager: server microservice
dishmanager: server microservice
usermanager: server microservice
menumanager: server microservice

mysqlClient: client(mysql)

mysql: db microservice

zeebe: zeebeClient,Camunda

/*COREOGRAPHIES*/

C_orderCreation =
compile_order_form: user -> acmeat-portal;
send_order_form: acmeat-portal -> apiorder;
create_order: apiorder -> orderClient;
create_order_async: orderClient -> ordermanager;

/* Qui avviene il deploy del diagramma BPMN all'interno dell'ordermanager */

process_order: zeebe -> ordermanager |
(C_checkLocalAvailability)

send_async: ordermanager -> mysqlClient;
create_order: mysqlClient -> mysql;

C_cancelOrder=
cancel_order_worker: zeebe -> ordermanager;
send_async: ordermanager -> mysqlClient;
delete_order: mysqlClient -> mysql;


C_checkLocalAvailability= 
check_local_availability_worker: zeebe -> ordermanager;

/* Carico le informazioni dell ordine*/

get_dishes: ordermanager -> dishClient;
get_local_by_id : ordermanager -> localClient;

/*Controllo se il locale è disponibile*/
check_order_availability: ordermanager -> localClient;
authenticate_to_local: localClient -> local;
check_order_availability: localClient -> local;
(
	localAvailable: localClient -> ordermanager;
)
	+
(
	error: zeebe -> ordermanager;
	C_cancelOrder;
)
;

C_handleLocalResponse=
finish_order: local -> apiorder;
handle_local_availability_response: apiorder -> orderClient;
handle_local_availability_response_async: orderClient -> ordermanager;
handle_local_response: ordermanager -> zeebe;

/*Se il locale non è disponibile cancello l'ordine*/
(
	C_cancelOrder;
)
	+
/* Altrimenti procedo con il contattare le società di consegna*/	
(
	C_checkDeliveryCompany
)



